(function(a){a.fn.addAutocomplete=function(){return this.each(function(){var b=a(this).data("keyboard");if(!b){return}b.autocomplete_init=function(c,d,e){if(b.options.alwaysOpen&&b.isVisible){b.autocomplete_setup()}b.$el.bind("visible.keyboard",function(){b.autocomplete_setup()}).bind("change.keyboard",function(f){if(b.hasAutocomplete&&b.isVisible){b.$el.val(b.$preview.val()).trigger("keydown.autocomplete")}}).bind("hidden.keyboard",function(f){b.$el.autocomplete("close")}).bind("autocompleteopen",function(g,f){if(b.hasAutocomplete){b.$el.data("autocomplete").menu.element.position({of:b.$keyboard,my:"right top",at:"left top",collision:"flip"})}}).bind("autocompleteselect",function(g,f){if(b.hasAutocomplete&&f.item.value!==""){b.$preview.val(f.item.value).focus()}})};b.autocomplete_setup=function(){b.$autocomplete=b.$el.data("autocomplete");b.hasAutocomplete=(typeof(b.$autocomplete)==="undefined")?false:(b.$autocomplete.options.disabled)?false:true;if(b.hasAutocomplete&&!b.autocomplete_bind){b.$preview.bind("keydown.keyboard",function(c){return b.autocomplete_input(c)});b.autocomplete_bind=true}};b.autocomplete_input=function(d){var c,e=a.ui.keyCode;switch(d.keyCode){case e.PAGE_UP:b.$autocomplete._move("previousPage",d);break;case e.PAGE_DOWN:b.$autocomplete._move("nextPage",d);break;case e.UP:b.$autocomplete._move("previous",d);d.preventDefault();break;case e.DOWN:b.$autocomplete._move("next",d);d.preventDefault();break;case e.ENTER:case e.NUMPAD_ENTER:c=b.$autocomplete.menu.element.find("#ui-active-menuitem").text()||"";if(c!==""){b.$preview.val(c)}break;default:clearTimeout(b.$autocomplete.searching);b.$autocomplete.searching=setTimeout(function(){if(b.$autocomplete.term!=b.$autocomplete.element.val()){b.$autocomplete.selectedItem=null;b.$autocomplete.search(null,d)}},b.$autocomplete.options.delay);break}};b.origEscClose=b.escClose;b.escClose=function(c){if(b.hasAutocomplete&&c.target.id==="ui-active-menuitem"){return}b.origEscClose(c)};b.autocomplete_init()})}})(jQuery);